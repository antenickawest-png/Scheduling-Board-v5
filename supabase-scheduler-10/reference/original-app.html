

1 of 2,115
(no subject)
External
Inbox


Antenicka West
Attachments1:11‚ÄØPM (2 hours ago)
-- Antenicka WestAssistant Project ManagerCell: 314-546-8365 Office: 314-899-9444 Fax: 844-357-6444 Email: antenicka.west@rnstower.com

Nicka
Attachments2:29‚ÄØPM (53 minutes ago)
On Tue, Aug 26, 2025 at 1:11 PM Antenicka West <antenicka.west@rnstower.com> wrote: -- Antenicka WestAssistant Project ManagerCell: 314-546-8365 Office: 314-899

Nicka
Attachments3:07‚ÄØPM (14 minutes ago)
On Tue, Aug 26, 2025 at 2:29 PM Nicka <nickawest214@gmail.com> wrote: On Tue, Aug 26, 2025 at 1:11 PM Antenicka West <antenicka.west@rnstower.com> wrote: -- Ant

Nicka
Attachments
3:20‚ÄØPM (2 minutes ago)
to me

 One attachment
  ‚Ä¢  Scanned by Gmail
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>R&S Weekly Schedule</title>
<style>
/* Base Styles with Purple Pastel Color Scheme */
:root {
  --primary-color: #d1a3ff; /* Main purple pastel */
  --secondary-color: #f0d4ff; /* Lighter purple pastel */
  --accent-color: #b5c9ff; /* Complementary blue pastel */
  --light-color: #f8f5ff; /* Very light purple tint */
  --dark-color: #4a3b5c; /* Dark purple for text */
  --success-color: #c8e6c9; /* Light green */
  --warning-color: #fff0c8; /* Light yellow */
  --danger-color: #ffcdd2; /* Light red */
  --border-radius: 8px;
  --box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

body { 
  font-family: 'Segoe UI', sans-serif; 
  background: var(--light-color); 
  margin: 0; 
  padding: 0;
  color: var(--dark-color);
}

/* Login Page Styles */
.login-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
}

.login-box {
  background: white;
  padding: 30px;
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  width: 350px;
  max-width: 90%;
  text-align: center;
}

.login-box h2 {
  margin-bottom: 20px;
  color: var(--dark-color);
}

.login-form input {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border: 1px solid #ddd;
  border-radius: var(--border-radius);
  box-sizing: border-box;
}

.login-form button {
  width: 100%;
  padding: 10px;
  background: var(--primary-color);
  color: var(--dark-color);
  border: none;
  border-radius: var(--border-radius);
  cursor: pointer;
  font-size: 16px;
  margin-top: 10px;
}

.login-form button:hover {
  background: #c08aff;
}

.forgot-password {
  margin-top: 15px;
  font-size: 14px;
  color: #666;
  cursor: pointer;
}

.forgot-password:hover {
  text-decoration: underline;
}

.login-error {
  color: #e74c3c;
  margin-bottom: 15px;
  font-size: 14px;
  display: none;
}

/* Main App Styles */
header { 
  background: var(--primary-color); 
  padding: 10px; 
  display: flex; 
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
}

.header-title {
  font-size: 1.2rem;
  font-weight: bold;
  color: var(--dark-color);
  margin: 5px 0;
}

nav {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  justify-content: center;
}

nav button { 
  background: transparent; 
  border: none; 
  color: var(--dark-color); 
  font-size: 16px; 
  margin: 5px; 
  cursor: pointer; 
  padding: 5px 10px;
  border-radius: var(--border-radius);
}

nav button:hover {
  background: rgba(255, 255, 255, 0.3);
}

nav button.active { 
  background: white; 
  color: var(--dark-color); 
  font-weight: bold; 
  border-radius: var(--border-radius); 
}

.user-controls {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  justify-content: center;
  margin: 5px 0;
}

.user-info {
  margin-right: 15px;
  font-size: 14px;
}

.logout-btn {
  background: var(--secondary-color);
  color: var(--dark-color);
  border: none;
  padding: 5px 10px;
  border-radius: var(--border-radius);
  cursor: pointer;
}

.page { 
  display: none; 
  padding: 20px; 
}

.page.active { 
  display: block; 
}

.controls { 
  text-align: center; 
  margin-bottom: 20px; 
  background: var(--secondary-color);
  padding: 15px;
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  overflow-x: auto;
}

button.primary { 
  padding: 8px 12px; 
  margin: 5px; 
  background: var(--primary-color); 
  color: var(--dark-color); 
  border: none; 
  border-radius: var(--border-radius); 
  cursor: pointer; 
  font-size: 14px; 
  transition: all 0.2s;
  white-space: nowrap;
}

button.primary:hover {
  background: #c08aff;
  transform: translateY(-2px);
}

h1, h2 {
  color: var(--dark-color);
  margin-bottom: 20px;
  text-align: center;
}

/* Resources Styles */
.resources { 
  display: flex; 
  gap: 20px; 
  margin-bottom: 20px; 
  flex-wrap: wrap;
  justify-content: center;
}

.resource-section { 
  background: white; 
  border: 1px solid var(--secondary-color); 
  border-radius: var(--border-radius); 
  padding: 15px; 
  width: 180px;
  box-shadow: var(--box-shadow);
  min-width: 150px;
  flex: 1;
  max-width: 250px;
}

.resource-section h3 { 
  margin: 0 0 10px 0; 
  font-size: 16px; 
  text-align: center; 
  color: var(--dark-color);
  padding-bottom: 5px;
  border-bottom: 2px solid var(--primary-color);
}

.resource-section textarea { 
  width: 100%; 
  height: 60px; 
  padding: 8px; 
  margin-bottom: 10px; 
  border: 1px solid var(--primary-color); 
  border-radius: var(--border-radius); 
  font-size: 14px;
  box-sizing: border-box;
  resize: vertical;
}

.resource-section input[type="text"] { 
  display: none; 
}

.resource-list { 
  max-height: 150px; 
  overflow-y: auto; 
  border: 1px dashed var(--secondary-color); 
  padding: 8px;
  border-radius: var(--border-radius);
  background: #fafafa;
}

/* Board Styles */
.board { 
  display: flex; 
  overflow-x: auto; 
  gap: 15px; 
  padding: 15px; 
  min-height: 250px; 
  border-top: 1px solid var(--secondary-color);
  background: var(--light-color);
  border-radius: var(--border-radius);
  margin-bottom: 20px;
  -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
}

.column { 
  background: white; 
  border: 2px solid var(--secondary-color); 
  border-radius: var(--border-radius); 
  width: 180px; 
  min-height: 220px; 
  padding: 10px; 
  display: flex; 
  flex-direction: column;
  box-shadow: var(--box-shadow);
  flex: 0 0 auto;
}

.column input { 
  border: 1px solid var(--primary-color); 
  border-radius: var(--border-radius); 
  padding: 8px; 
  margin-bottom: 10px; 
  font-size: 14px;
  text-align: center;
  font-weight: bold;
}

.column.selected { 
  border: 2px solid #ff9e80; 
  background-color: #fff8e0; 
}

/* Status Boxes Styles */
.permanent-boxes-header { 
  margin-top: 30px; 
  border-top: 1px solid var(--secondary-color); 
  padding-top: 20px; 
}

.permanent-boxes-container { 
  display: flex; 
  justify-content: space-around; 
  margin: 20px 0;
  flex-wrap: wrap;
  gap: 15px;
}

.permanent-box { 
  background: white; 
  border: 2px solid var(--secondary-color); 
  border-radius: var(--border-radius); 
  width: 22%; 
  min-height: 150px; 
  padding: 10px;
  box-shadow: var(--box-shadow);
  min-width: 200px;
  flex: 1;
}

.permanent-box h3 { 
  text-align: center; 
  margin: 5px 0 10px 0; 
  background: var(--secondary-color); 
  padding: 8px; 
  border-radius: var(--border-radius);
  color: var(--dark-color);
}

/* Tile Styles */
.tile { 
  padding: 8px; 
  border-radius: var(--border-radius); 
  margin: 5px 0; 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  cursor: move; 
  font-size: 14px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  touch-action: none; /* Improves touch handling */
}

.tile.crew { 
  background: var(--primary-color); 
}

.tile.truck { 
  background: var(--secondary-color); 
}

.tile.trailer { 
  background: var(--success-color); 
}

.tile.equipment { 
  background: var(--warning-color); 
}

.tile.combo { 
  background: linear-gradient(135deg, var(--primary-color) 25%, var(--secondary-color) 25%, var(--secondary-color) 50%, var(--success-color) 50%, var(--success-color) 75%, var(--warning-color) 75%); 
}

.tile-buttons button { 
  background: transparent; 
  border: none; 
  font-size: 14px; 
  cursor: pointer; 
  margin-left: 5px;
  opacity: 0.7;
  transition: opacity 0.2s;
  min-width: 24px;
  min-height: 24px;
}

.tile-buttons button:hover {
  opacity: 1;
}

.tile.selected { 
  border: 2px solid #ff9e80; 
  box-shadow: 0 0 5px rgba(255, 158, 128, 0.5);
}

/* Location Styles */
.location-zone { 
  background: white; 
  border: 2px solid var(--secondary-color); 
  border-radius: var(--border-radius); 
  width: 220px; 
  min-height: 200px; 
  padding: 10px; 
  margin: 10px;
  box-shadow: var(--box-shadow);
  flex: 1;
  min-width: 200px;
}

.location-zone h3 { 
  text-align: center; 
  margin: 5px 0 10px 0;
  background: var(--secondary-color);
  padding: 8px;
  border-radius: var(--border-radius);
  color: var(--dark-color);
}

.location-container { 
  display: flex; 
  flex-wrap: wrap; 
  justify-content: center; 
  margin-top: 20px; 
  gap: 15px;
}

.locations-header { 
  margin-top: 30px; 
  border-top: 1px solid var(--secondary-color); 
  padding-top: 20px; 
}

/* Combo Controls */
.combo-controls { 
  margin: 15px 0; 
  text-align: center;
  background: var(--secondary-color);
  padding: 15px;
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
}

.combo-name { 
  width: 180px; 
  padding: 8px; 
  margin-right: 10px;
  border: 1px solid var(--primary-color);
  border-radius: var(--border-radius);
}

/* User Management Styles */
.user-management {
  max-width: 800px;
  margin: 0 auto;
  background: white;
  padding: 20px;
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  overflow-x: auto;
}

.user-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
}

.user-table th, .user-table td {
  padding: 10px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}

.user-table th {
  background-color: var(--primary-color);
  color: var(--dark-color);
}

.user-table tr:nth-child(even) {
  background-color: var(--light-color);
}

.user-form {
  background: var(--secondary-color);
  padding: 15px;
  border-radius: var(--border-radius);
  margin-bottom: 20px;
}

.user-form h3 {
  margin-top: 0;
  margin-bottom: 15px;
}

.form-group {
  margin-bottom: 15px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
}

.form-group input, .form-group select {
  width: 100%;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: var(--border-radius);
  box-sizing: border-box;
}

.action-btn {
  padding: 5px 10px;
  border: none;
  border-radius: var(--border-radius);
  cursor: pointer;
  font-size: 14px;
  margin: 2px;
}

.edit-btn {
  background-color: var(--primary-color);
  color: var(--dark-color);
}

.delete-btn {
  background-color: var(--danger-color);
  color: var(--dark-color);
}

.reset-btn {
  background-color: var(--warning-color);
  color: var(--dark-color);
}

/* Modal Styles */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
  background-color: white;
  margin: 15% auto;
  padding: 20px;
  border-radius: var(--border-radius);
  width: 350px;
  max-width: 90%;
  box-shadow: var(--box-shadow);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.modal-header h3 {
  margin: 0;
}

.close-modal {
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
}

.modal-body {
  margin-bottom: 20px;
}

.modal-footer {
  text-align: right;
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.fade-in {
  animation: fadeIn 0.3s ease-in;
}

/* Tooltips */
.tooltip {
  position: relative;
  display: inline-block;
}

.tooltip .tooltip-text {
  visibility: hidden;
  width: 120px;
  background-color: #333;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -60px;
  opacity: 0;
  transition: opacity 0.3s;
}

.tooltip:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

/* Enhanced Mobile Responsiveness */
@media (max-width: 768px) {
  header {
    flex-direction: column;
    padding: 10px 5px;
  }
  
  .header-title {
    margin-bottom: 10px;
  }
  
  nav {
    width: 100%;
    justify-content: center;
    margin-bottom: 10px;
  }
  
  nav button {
    padding: 8px;
    margin: 3px;
    font-size: 14px;
  }
  
  .user-controls {
    width: 100%;
    justify-content: center;
  }
  
  .resources {
    flex-direction: column;
    align-items: center;
  }
  
  .resource-section {
    width: 90%;
    max-width: none;
  }
  
  .permanent-box {
    width: 90%;
    margin-bottom: 15px;
    min-width: 0;
  }
  
  .location-zone {
    width: 90%;
    min-width: 0;
  }
  
  .controls {
    padding: 10px;
  }
  
  button.primary {
    padding: 8px;
    font-size: 13px;
  }
  
  .combo-name {
    width: 100%;
    margin-right: 0;
    margin-bottom: 10px;
  }
  
  .combo-controls {
    padding: 10px;
  }
  
  .board {
    padding: 10px 5px;
  }
  
  .column {
    min-width: 160px;
  }
  
  .user-management {
    padding: 10px;
  }
  
  .user-table th, .user-table td {
    padding: 8px 5px;
    font-size: 13px;
  }
  
  .action-btn {
    padding: 4px 8px;
    font-size: 12px;
  }
}

/* Password Change Modal */
#passwordChangeModal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
}

.password-change-content {
  background-color: white;
  margin: 15% auto;
  padding: 20px;
  border-radius: var(--border-radius);
  width: 350px;
  max-width: 90%;
  box-shadow: var(--box-shadow);
}

/* Touch-friendly improvements */
@media (pointer: coarse) {
  .tile {
    padding: 12px 8px;
    margin: 8px 0;
  }
  
  .tile-buttons button {
    padding: 5px;
    min-width: 30px;
    min-height: 30px;
  }
  
  button.primary {
    padding: 10px 15px;
  }
  
  .column input {
    padding: 10px;
  }
  
  select, input[type="text"], input[type="password"] {
    font-size: 16px; /* Prevents iOS zoom on focus */
    padding: 10px;
  }
}

  .admin-panel {
  background: #f5f5f5;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 20px;
  margin: 20px 0;
}

.user-management, .sync-controls {
  margin: 15px 0;
}

.users-list {
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid #ddd;
  padding: 10px;
  background: white;
}

.user-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px;
  border-bottom: 1px solid #eee;
}

.sync-status {
  margin-top: 10px;
  font-size: 0.9em;
  color: #666;
}
  
</style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
<!-- Login Page -->
<div id="loginPage" class="login-container">
  <div class="login-box">
    
    <h2>üîê R&S Weekly Schedule</h2>
    <div id="loginError" class="login-error">Invalid username or password</div>
    <form class="login-form" id="loginForm" onsubmit="return false;">
                    <div class="form-group">
                        <label for="username">Email:</label>
                        <!-- Updated placeholder and input type for email -->
                        <input type="email" id="username" placeholder="Enter your email" required>
                    </div>
      <input type="password" id="password" placeholder="Password" required>
      <button type="submit" onclick="attemptLogin()">üöÄ Login</button>
      <div class="forgot-password" onclick="showForgotPassword()">Forgot password?</div>
    </form>
  </div>
</div>

<!-- Forgot Password Modal -->
<div id="forgotPasswordModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>üîë Forgot Password</h3>
      <span class="close-modal" onclick="closeForgotPassword()">&times;</span>
    </div>
    <div class="modal-body">
      <p>Please enter your username to reset your password.</p>
      <input type="text" id="resetUsername" placeholder="Username" style="width: 100%; padding: 8px; margin-top: 10px; border: 1px solid #ddd; border-radius: 8px;">
      <div id="resetMessage" style="margin-top: 10px; color: #27ae60; display: none;"></div>
    </div>
    <div class="modal-footer">
      <button class="primary" onclick="requestPasswordReset()">Reset Password</button>
    </div>
  </div>
</div>

<!-- Password Change Modal -->
<div id="passwordChangeModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>üîê Change Password</h3>
      <span class="close-modal" onclick="closePasswordChange()">&times;</span>
    </div>
    <div class="modal-body">
      <p>Please change your default password to continue.</p>
      <div class="form-group">
        <label for="newPassword1">New Password</label>
        <input type="password" id="newPassword1" placeholder="Enter new password">
      </div>
      <div class="form-group">
        <label for="newPassword2">Confirm Password</label>
        <input type="password" id="newPassword2" placeholder="Confirm new password">
      </div>
      <div id="passwordChangeMessage" style="margin-top: 10px; color: #e74c3c; display: none;"></div>
    </div>
    <div class="modal-footer">
      <button class="primary" onclick="changePassword()">Update Password</button>
    </div>
  </div>
</div>

<!-- Admin Panel Section (only visible to admins) -->
<div id="admin-panel" class="admin-panel" style="display: none;">
  <h3>Admin Panel</h3>
  
  <!-- User Management -->
  <div class="user-management">
    <h4>User Management</h4>
    <div id="users-list" class="users-list">
      <!-- Users will be populated here -->
    </div>
  </div>
  
  <!-- Sync Controls -->
  <div class="sync-controls">
    <h4>Data Sync</h4>
    <button id="manual-sync-btn" class="btn">Manual Sync</button>
    <button id="toggle-auto-sync-btn" class="btn">Toggle Auto Sync</button>
    <div id="sync-status" class="sync-status">
      <span id="last-sync-time">Never synced</span>
    </div>
  </div>
</div>

  
<!-- Main Application -->
<div id="appContainer" style="display: none;">
  <header>
    <div class="header-title">R&S Weekly Schedule</div>
    <nav>
      <button id="tab1" class="active" onclick="showPage(1)">üìã Board & Resources</button>
      <button id="tab2" onclick="showPage(2)">üíæ Saved Schedules</button>
      <button id="tab3" onclick="showPage(3)" class="admin-only">üë• User Management</button>
    </nav>
    <div class="user-controls">
      
      
      <!-- Combo Save Button hidden -->
      <div class="user-info">
        <span id="currentUser">User</span> (<span id="userRole">Role</span>)
      </div>
      <button class="logout-btn" onclick="logout()">üö™ Logout</button>
    </div>
  </header>

  <!-- Page 1: Board & Resources -->
  <div id="page1" class="page active">
    <h1>üìÖ Weekly Sites & Resources</h1>
    <div class="controls">
      <button class="primary pdf-btn" onclick="exportToPDF()">üìÑ Export PDF</button>
      <button class="primary" onclick="addSite()">‚ûï Add Site</button>
      <button class="primary" onclick="deleteSite()">üóëÔ∏è Delete Site</button>
      <button class="primary" onclick="clearSites()">üßπ Clear Board</button>
      <button class="primary" onclick="eraseBoard()">üóëÔ∏è Erase Board</button>
      <button class="primary" onclick="autoSave()">üíæ Auto-Save</button>
      <button class="primary" onclick="loadSaved()">üìÇ Load</button>
      <select id="savedSelectFirst"></select>
      <button class="primary" onclick="saveSnapshot()">üì∏ Save Snapshot</button>
    </div>
    <div class="combo-controls" style="display:none;">
      <input type="text" class="combo-name" id="comboName" placeholder="Combo Name">
      <button class="primary" onclick="addCombo()">üîÑ Add Combo</button>
    </div>
    <div class="resources">
      <div class="resource-section">
        <h3>üë∑ Crew</h3>
        <textarea id="crewInput" placeholder="One name per line"></textarea>
        <button class="primary" onclick="addCrew()">‚ûï </button>
        <button class="primary" onclick="clearCrew()">üßπ </button>
        <div id="crewList" class="resource-list" ondragover="allowDrop(event)" ondrop="drop(event)"></div>
      </div>
      <div class="resource-section">
        <h3>üöö Trucks</h3>
        <textarea id="truckInput" placeholder="One tag per line"></textarea>
        <button class="primary" onclick="addTruck()">‚ûï </button>
        <button class="primary" onclick="clearTruck()">üßπ </button>
        <div id="truckList" class="resource-list" ondragover="allowDrop(event)" ondrop="drop(event)"></div>
      </div>
      <div class="resource-section">
        <h3>üöõ Trailers</h3>
        <textarea id="trailerInput" placeholder="One tag per line"></textarea>
        <button class="primary" onclick="addTrailer()">‚ûï </button>
        <button class="primary" onclick="clearTrailer()">üßπ </button>
        <div id="trailerList" class="resource-list" ondragover="allowDrop(event)" ondrop="drop(event)"></div>
      </div>
      <div class="resource-section">
        <h3>üîß Equipment</h3>
        <textarea id="equipmentInput" placeholder="One item per line"></textarea>
        <button class="primary" onclick="addEquipment()">‚ûï </button>
        <button class="primary" onclick="clearEquipment()">üßπ </button>
        <div id="equipmentList" class="resource-list" ondragover="allowDrop(event)" ondrop="drop(event)"></div>
      </div>
      <div class="resource-section" style="display:none;">
        <h3>üîÑ Combos</h3>
        <div id="comboList" class="resource-list" ondragover="allowDrop(event)" ondrop="drop(event)"></div>
      </div>
    </div>
    <div class="board" id="board" ondragover="allowDrop(event)" ondrop="drop(event)"></div>
    <!-- Permanent Status Boxes -->
    <div class="permanent-boxes-header">
      <h2>üìä Status Zones</h2>
    </div>
    <div class="permanent-boxes-container">
      <div class="permanent-box" id="off-box" ondragover="allowDrop(event)" ondrop="drop(event)">
        <h3>üè† Off</h3>
      </div>
      <div class="permanent-box" id="available-box" ondragover="allowDrop(event)" ondrop="drop(event)">
        <h3>‚úÖ Available</h3>
      </div>
      <div class="permanent-box" id="shop-box" ondragover="allowDrop(event)" ondrop="drop(event)">
        <h3>üîß Shop/Logistics</h3>
      </div>
      <div class="permanent-box" id="djmuse-box" ondragover="allowDrop(event)" ondrop="drop(event)">
        <h3>üè¢ DJM Use</h3>
      </div>
    </div>

    <!-- Locations Section -->
    <div class="locations-header">
      <h2>üìç Locations</h2>
      <div class="controls">
      <button class="primary pdf-btn" onclick="exportToPDF()">üìÑ Export PDF</button>
        <button class="primary" onclick="saveLocationBoard()">üíæ Save Locations</button>
        <button class="primary" onclick="clearLocationBoard()">üßπ Clear Locations</button>
      </div>
    </div>
    <div class="location-container">
      <div class="location-zone" id="kc-zone" ondragover="allowDrop(event)" ondrop="dropLocation(event, 'KC')">
        <h3>üèôÔ∏è KC</h3>
      </div>
      <div class="location-zone" id="indy-zone" ondragover="allowDrop(event)" ondrop="dropLocation(event, 'Indy')">
        <h3>üèÅ Indy</h3>
      </div>
      <div class="location-zone" id="stl-zone" ondragover="allowDrop(event)" ondrop="dropLocation(event, 'STL')">
        <h3>üåâ STL</h3>
      </div>
    </div>
  </div>

  <!-- Page 2: Saved Schedules -->
  <div id="page2" class="page">
    <h1>üíæ Saved Schedules</h1>
    <div class="controls">
      <button class="primary pdf-btn" onclick="exportToPDF()">üìÑ Export PDF</button>
      <select id="savedSelect"></select>
      <button class="primary" onclick="loadSavedPage2()">üìÇ Load Sites</button>
      <button class="primary" onclick="saveSnapshotPage2()">üì∏ Save Snapshot</button>
      <button class="primary" onclick="clearSavedLogs()">üßπ Clear Saved Logs</button>
    </div>
    <div id="savedBoardDisplay" class="board"></div>
  </div>

  <!-- Page 3: User Management (Admin Only) -->
  <div id="page3" class="page">
    <h1>üë• User Management</h1>
    <div class="user-management">
      <div class="user-form">
        <h3>‚ûï Add New User</h3>
        <div class="form-group">
          <label for="newUsername">Username</label>
          <input type="text" id="newUsername" required>
        </div>
        <div class="form-group">
          <label for="newRole">Role</label>
          <select id="newRole">
            <option value="admin">Admin</option>
            <option value="view">View Only</option>
          </select>
        </div>
        <button class="primary" onclick="addUser()">‚ûï Add User</button>
      </div>
      
      <div class="controls">
      <button class="primary pdf-btn" onclick="exportToPDF()">üìÑ Export PDF</button>
        <button class="primary" onclick="resetAllPasswords()">üîë Reset All Passwords to 1234</button>
      </div>
      
      <h3>üßë‚Äçüíº User List</h3>
      <table class="user-table">
        <thead>
          <tr>
            <th>Username</th>
            <th>Role</th>
            <th>Password Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="userTableBody">
          <!-- User rows will be added here dynamically -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || 'https://ldbjgdfkjnpxwvrofmkx.supabase.co';
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxkYmpnZGZram5weHd2cm9mbWt4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4OTMwMTYsImV4cCI6MjA3MDQ2OTAxNn0.2DeJq25bo_3nKG_PhkWaUUssVjUqQSRqsoeo8zZ4dFg';
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

// User Authentication System
let currentUser = null;
let isAdmin = false;
const DEFAULT_PASSWORD = '1234';

async function checkAuthSession() {
  try {
    const { data: { session } } = await supabase.auth.getSession();
    if (session && session.user) {
      currentUser = session.user.email;
      
      // Get user profile from database
      const { data: profile } = await supabase
        .from('profiles')
        .select('role')
        .eq('email', session.user.email)
        .single();
      
      isAdmin = profile?.role === 'admin';
      
      // Show main app
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('appContainer').style.display = 'block';
      document.getElementById('currentUser').textContent = currentUser;
      document.getElementById('userRole').textContent = profile?.role || 'user';
      
      updateAdminVisibility();
      renderAll();
      populateSavedFirst();
      populateSaved();
      loadLocationData();
      
      if (isAdmin) {
        loadUsers();
      }
    }
  } catch (error) {
    console.error('Auth session check error:', error);
  }
}

async function attemptLogin() {
  const email = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  
  if (!email || !password) {
    showLoginError('Please enter both email and password');
    return;
  }

  try {
    const { data, error } = await supabase.auth.signInWithPassword({
      email: email,
      password: password
    });

    if (error) {
      showLoginError('Login failed: ' + error.message);
      return;
    }

    if (data.user) {
      currentUser = data.user.email;
      
      // Get or create user profile
      let { data: profile, error: profileError } = await supabase
        .from('profiles')
        .select('*')
        .eq('email', data.user.email)
        .single();
      
      if (profileError && profileError.code === 'PGRST116') {
        // Profile doesn't exist, create it
        const { data: newProfile, error: createError } = await supabase
          .from('profiles')
          .insert([{
            email: data.user.email,
            role: data.user.email === 'antenicka.west@rnstower.com' ? 'admin' : 'user',
            password_changed: true
          }])
          .select()
          .single();
        
        if (createError) {
          showLoginError('Error creating profile: ' + createError.message);
          return;
        }
        profile = newProfile;
      } else if (profileError) {
        showLoginError('Error fetching profile: ' + profileError.message);
        return;
      }
      
      isAdmin = profile.role === 'admin';
      
      // Update UI
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('appContainer').style.display = 'block';
      document.getElementById('currentUser').textContent = currentUser;
      document.getElementById('userRole').textContent = profile.role;
      
      updateAdminVisibility();
      renderAll();
      populateSavedFirst();
      populateSaved();
      loadLocationData();
      
      if (isAdmin) {
        loadUsers();
      }
    }
  } catch (error) {
    console.error('Login error:', error);
    showLoginError('Login failed. Please try again.');
  }
}

function showLoginError(message) {
  const errorDiv = document.getElementById('loginError');
  errorDiv.textContent = message;
  errorDiv.style.display = 'block';
  setTimeout(() => {
    errorDiv.style.display = 'none';
  }, 5000);
}

async function logout() {
  try {
    await supabase.auth.signOut();
    currentUser = null;
    isAdmin = false;
    document.getElementById('loginPage').style.display = 'flex';
    document.getElementById('appContainer').style.display = 'none';
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
  } catch (error) {
    console.error('Logout error:', error);
  }
}

function updateAdminVisibility() {
  const adminElements = document.querySelectorAll('.admin-only');
  adminElements.forEach(el => {
    el.style.display = isAdmin ? 'block' : 'none';
  });
}

async function loadUsers() {
  try {
    const { data: users, error } = await supabase
      .from('profiles')
      .select('*')
      .order('email');
    
    if (error) {
      console.error('Error loading users:', error);
      return;
    }
    
    const tableBody = document.getElementById('userTableBody');
    tableBody.innerHTML = '';
    
    users.forEach(user => {
      const row = document.createElement('tr');
      
      const usernameCell = document.createElement('td');
      usernameCell.textContent = user.email;
      row.appendChild(usernameCell);
      
      const roleCell = document.createElement('td');
      roleCell.textContent = user.role;
      row.appendChild(roleCell);
      
      const passwordStatusCell = document.createElement('td');
      passwordStatusCell.textContent = user.password_changed ? 'Changed' : 'Default';
      row.appendChild(passwordStatusCell);
      
      const actionsCell = document.createElement('td');
      
      if (user.email !== currentUser) {
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'üóëÔ∏è Delete';
        deleteBtn.className = 'action-btn delete-btn';
        deleteBtn.onclick = () => deleteUser(user.email);
        actionsCell.appendChild(deleteBtn);
      } else {
        actionsCell.textContent = 'Current User';
      }
      
      row.appendChild(actionsCell);
      tableBody.appendChild(row);
    });
  } catch (error) {
    console.error('Error loading users:', error);
  }
}

async function addUser() {
  const email = document.getElementById('newUsername').value;
  const role = document.getElementById('newRole').value;
  
  if (!email) {
    alert('Please enter an email');
    return;
  }
  
  try {
    // Check if user already exists
    const { data: existingUser } = await supabase
      .from('profiles')
      .select('email')
      .eq('email', email)
      .single();
    
    if (existingUser) {
      alert('User already exists');
      return;
    }
    
    // Create user profile
    const { error } = await supabase
      .from('profiles')
      .insert([{
        email: email,
        role: role,
        password_changed: false
      }]);
    
    if (error) {
      alert('Error adding user: ' + error.message);
      return;
    }
    
    // Clear form
    document.getElementById('newUsername').value = '';
    
    // Reload user list
    loadUsers();
    
    alert(`User ${email} added. They can sign up with this email.`);
  } catch (error) {
    console.error('Error adding user:', error);
    alert('Error adding user');
  }
}

async function deleteUser(email) {
  if (confirm(`Are you sure you want to delete user ${email}?`)) {
    try {
      const { error } = await supabase
        .from('profiles')
        .delete()
        .eq('email', email);
      
      if (error) {
        alert('Error deleting user: ' + error.message);
        return;
      }
      
      loadUsers();
    } catch (error) {
      console.error('Error deleting user:', error);
      alert('Error deleting user');
    }
  }
}

async function deleteResource(key, id, listId, type) {
  try {
    const { error } = await supabase
      .from('resources')
      .delete()
      .eq('id', id)
      .eq('user_email', currentUser);
    
    if (error) {
      console.error('Error deleting resource:', error);
      return;
    }
    
    render(key, listId, type);
  } catch (error) {
    console.error('Error deleting resource:', error);
  }
}

async function clearResource(key, listId, type) {
  if (confirm('Clear all ' + key + '?')) {
    try {
      const { error } = await supabase
        .from('resources')
        .delete()
        .eq('user_email', currentUser)
        .eq('type', key);
      
      if (error) {
        console.error('Error clearing resources:', error);
        return;
      }
      
      render(key, listId, type);
    } catch (error) {
      console.error('Error clearing resources:', error);
    }
  }
}

function addResource(key, textAreaId, listId, type) {
  const lines = document.getElementById(textAreaId).value.trim().split('\n').map(l=>l.trim()).filter(l=>l);
  if(!lines.length) return;
  
  try {
    const resourcesToAdd = [];
    for (const name of lines) {
      // Check if resource already exists
      const { data: existing } = await supabase
        .from('resources')
        .select('id')
        .eq('user_email', currentUser)
        .eq('type', key)
        .eq('name', name)
        .single();
      
      if (!existing) {
        const id = key+'_'+Date.now()+'_'+Math.random().toString(36).substr(2,5);
        resourcesToAdd.push({
          id: id,
          user_email: currentUser,
          type: key,
          name: name
        });
      }
    }
    
    if (resourcesToAdd.length > 0) {
      const { error } = await supabase
        .from('resources')
        .insert(resourcesToAdd);
      
      if (error) {
        console.error('Error adding resources:', error);
        return;
      }
    }
    
    document.getElementById(textAreaId).value='';
    render(key, listId, type);
  } catch (error) {
    console.error('Error adding resources:', error);
  }
}

async function render(key, listId, type) {
  const pool = document.getElementById(listId);
  if (!pool) return;
  pool.innerHTML='';
  
  try {
    const { data: resources, error } = await supabase
      .from('resources')
      .select('*')
      .eq('user_email', currentUser)
      .eq('type', key)
      .order('name');
    
    if (error) {
      console.error('Error loading resources:', error);
      return;
    }
    
    resources.forEach(item=>{
      const tile = document.createElement('div');
      tile.className = 'tile '+type;
      tile.id = item.id;
      tile.draggable = true;
      tile.ondragstart = drag;
      tile.onclick = toggleSelection;
      const span = document.createElement('span');
      span.textContent = item.name;
      tile.appendChild(span);
      // Add delete button
      const del = document.createElement('button');
      del.textContent = '‚ùå';
      del.onclick = (e) => { e.stopPropagation(); deleteResource(key, item.id, listId, type); };
      const btnWrap = document.createElement('div');
      btnWrap.className = 'tile-buttons';
      btnWrap.appendChild(del);
      tile.appendChild(btnWrap);
      pool.appendChild(tile);
    });
  } catch (error) {
    console.error('Error rendering resources:', error);
  }
}

async function deleteResource(key, id, listId, type) {
  try {
    const { error } = await supabase
      .from('resources')
      .delete()
      .eq('id', id)
      .eq('user_email', currentUser);
    
    if (error) {
      console.error('Error deleting resource:', error);
      return;
    }
    
    render(key, listId, type);
  } catch (error) {
    console.error('Error deleting resource:', error);
  }
}

async function clearResource(key, listId, type) {
  if (confirm('Clear all ' + key + '?')) {
    try {
      const { error } = await supabase
        .from('resources')
        .delete()
        .eq('user_email', currentUser)
        .eq('type', key);
      
      if (error) {
        console.error('Error clearing resources:', error);
        return;
      }
      
      render(key, listId, type);
    } catch (error) {
      console.error('Error clearing resources:', error);
    }
  }
}

function addCrew(){ addResource('crews','crewInput','crewList','crew'); }
function renderCrew(){ render('crews','crewList','crew'); }
function addTruck(){ addResource('trucks','truckInput','truckList','truck'); }
function renderTruck(){ render('trucks','truckList','truck'); }
function addTrailer(){ addResource('trailers','trailerInput','trailerList','trailer'); }
function renderTrailer(){ render('trailers','trailerList','trailer'); }
function addEquipment(){ addResource('equipment','equipmentInput','equipmentList','equipment'); }
function renderEquipment(){ render('equipment','equipmentList','equipment'); }

function clearCrew() { clearResource('crews','crewList','crew'); }
function clearTruck() { clearResource('trucks','truckList','truck'); }
function clearTrailer() { clearResource('trailers','trailerList','trailer'); }
function clearEquipment() { clearResource('equipment','equipmentList','equipment'); }

async function autoSave() {
  // Make sure all input values are reflected in their value attributes before saving
  document.querySelectorAll('#board .column input').forEach(input => {
    input.setAttribute('value', input.value);
  });
  
  // Create a container for both board and permanent boxes
  const saveContainer = document.createElement('div');
  
  // Add board content
  const boardContent = document.createElement('div');
  boardContent.setAttribute('data-content-type', 'board');
  boardContent.innerHTML = document.getElementById('board').innerHTML;
  saveContainer.appendChild(boardContent);
  
  // Add permanent boxes content
  ['off-box', 'available-box', 'shop-box', 'djmuse-box'].forEach(boxId => {
    const boxContent = document.createElement('div');
    boxContent.setAttribute('data-content-type', boxId);
    boxContent.innerHTML = document.getElementById(boxId).innerHTML;
    saveContainer.appendChild(boxContent);
  });
  
  try {
    const { error } = await supabase
      .from('schedules')
      .insert([{
        user_email: currentUser,
        html_content: saveContainer.innerHTML,
        created_at: new Date().toISOString()
      }]);
    
    if (error) {
      console.error('Error saving schedule:', error);
      return;
    }
    
    populateSavedFirst();
    populateSaved();
  } catch (error) {
    console.error('Error auto-saving:', error);
  }
}

async function populateSavedFirst(){
  const sel = document.getElementById('savedSelectFirst');
  sel.innerHTML='';
  
  try {
    const { data: schedules, error } = await supabase
      .from('schedules')
      .select('id, created_at')
      .eq('user_email', currentUser)
      .order('created_at', { ascending: false })
      .limit(50);
    
    if (error) {
      console.error('Error loading schedules:', error);
      return;
    }
    
    schedules.forEach((s,i)=>{
      sel.append(new Option(new Date(s.created_at).toLocaleString(), s.id));
    });
  } catch (error) {
    console.error('Error populating saved schedules:', error);
  }
}

async function populateSaved(){
  const sel = document.getElementById('savedSelect');
  sel.innerHTML='';
  
  try {
    const { data: schedules, error } = await supabase
      .from('schedules')
      .select('id, created_at')
      .eq('user_email', currentUser)
      .order('created_at', { ascending: false })
      .limit(50);
    
    if (error) {
      console.error('Error loading schedules:', error);
      return;
    }
    
    schedules.forEach((s,i)=>{
      sel.append(new Option(new Date(s.created_at).toLocaleString(), s.id));
    });
  } catch (error) {
    console.error('Error populating saved schedules:', error);
  }
}

async function loadSaved() {
  const selFirst = document.getElementById('savedSelectFirst');
  const sel = selFirst && selFirst.value!=='' ? selFirst : document.getElementById('savedSelect');
  const scheduleId = sel.value;
  
  if (!scheduleId) return;
  
  try {
    const { data: schedule, error } = await supabase
      .from('schedules')
      .select('html_content')
      .eq('id', scheduleId)
      .eq('user_email', currentUser)
      .single();
    
    if (error) {
      console.error('Error loading schedule:', error);
      return;
    }
    
    if (schedule) {
      const tmp = document.createElement('div');
      tmp.innerHTML = schedule.html_content;
      
      // Load board content
      const boardContent = tmp.querySelector('[data-content-type="board"]');
      if (boardContent) {
        document.getElementById('board').innerHTML = boardContent.innerHTML;
      } else {
        // Fallback for older saved data
        document.getElementById('board').innerHTML = schedule.html_content;
      }
      
      // Load permanent boxes content
      ['off-box', 'available-box', 'shop-box', 'djmuse-box'].forEach(boxId => {
        const boxContent = tmp.querySelector(`[data-content-type="${boxId}"]`);
        if (boxContent) {
          document.getElementById(boxId).innerHTML = boxContent.innerHTML;
        }
      });
      
      // Reattach event handlers to loaded elements
      document.querySelectorAll('#board .column').forEach(col => {
        col.ondragover = allowDrop;
        col.ondrop = drop;
        col.onclick = toggleColumnSelection;
        col.draggable = true;
        col.ondragstart = dragColumn;
      });
      
      document.querySelectorAll('#board .tile, .permanent-box .tile').forEach(tile => {
        tile.draggable = true;
        tile.ondragstart = drag;
        
        // Reattach button event handlers
        const returnBtn = tile.querySelector('.tile-buttons button:first-child');
        if (returnBtn) returnBtn.onclick = () => returnTile(tile.id);
        
        const delBtn = tile.querySelector('.tile-buttons button:last-child');
        if (delBtn) delBtn.onclick = () => delSiteTile(tile.id);
      });
    }
  } catch (error) {
    console.error('Error loading saved schedule:', error);
  }
}

async function saveLocationData() {
  const locations = {
    KC: [],
    Indy: [],
    STL: []
  };
  
  // Collect data from each location zone
  document.querySelectorAll('.location-zone').forEach(zone => {
    const location = zone.querySelector('h3').textContent.replace(/[üèôÔ∏èüèÅüåâ ]/g, '').trim();
    zone.querySelectorAll('.tile').forEach(tile => {
      locations[location].push({
        id: tile.id,
        html: tile.outerHTML
      });
    });
  });
  
  try {
    const { error } = await supabase
      .from('locations')
      .upsert([{
        user_email: currentUser,
        location_data: JSON.stringify(locations)
      }], {
        onConflict: 'user_email'
      });
    
    if (error) {
      console.error('Error saving location data:', error);
    }
  } catch (error) {
    console.error('Error saving location data:', error);
  }
}

async function loadLocationData() {
  try {
    const { data: locationRecord, error } = await supabase
      .from('locations')
      .select('location_data')
      .eq('user_email', currentUser)
      .single();
    
    if (error && error.code !== 'PGRST116') {
      console.error('Error loading location data:', error);
      return;
    }
    
    const locations = locationRecord ? JSON.parse(locationRecord.location_data) : {};
    
    // Clear all zones
    document.querySelectorAll('.location-zone').forEach(zone => {
      // Keep only the h3 header
      const header = zone.querySelector('h3');
      zone.innerHTML = '';
      zone.appendChild(header);
    });
    
    // Load data into each zone
    Object.keys(locations).forEach(location => {
      let zoneId;
      if (location === 'KC') zoneId = 'kc-zone';
      else if (location === 'Indy') zoneId = 'indy-zone';
      else if (location === 'STL') zoneId = 'stl-zone';
      else return;
      
      const zone = document.getElementById(zoneId);
      if (!zone) return;
      
      locations[location].forEach(item => {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = item.html;
        const tile = tempDiv.firstChild;
        
        // Make sure it's draggable and has event handlers
        tile.draggable = true;
        tile.ondragstart = drag;
        
        // Reattach button event handlers
        const returnBtn = tile.querySelector('.tile-buttons button:first-child');
        if (returnBtn) returnBtn.onclick = () => returnTileToResourceList(item.id);
        
        const delBtn = tile.querySelector('.tile-buttons button:last-child');
        if (delBtn) delBtn.onclick = () => delSiteTile(item.id);
        
        zone.appendChild(tile);
      });
    });
  } catch (error) {
    console.error('Error loading location data:', error);
  }
}

function clearLocationBoard() {
  document.querySelectorAll('.location-zone').forEach(zone => {
    // Keep only the h3 header
    const header = zone.querySelector('h3');
    zone.innerHTML = '';
    zone.appendChild(header);
  });
  
  saveLocationData();
}


function deleteResource(key, id, listId, type) {
  let arr = JSON.parse(localStorage.getItem(key) || '[]');
  arr = arr.filter(item => item.id !== id);
  localStorage.setItem(key, JSON.stringify(arr));
  render(key, listId, type);
}

function clearResource(key, listId, type) {
  if (confirm('Clear all ' + key + '?')) {
    localStorage.removeItem(key);
    render(key, listId, type);
  }
}

function clearCrew() { clearResource('crews','crewList','crew'); }
function clearTruck() { clearResource('trucks','truckList','truck'); }
function clearTrailer() { clearResource('trailers','trailerList','trailer'); }
function clearEquipment() { clearResource('equipment','equipmentList','equipment'); }

function renderAll(){
  renderCrew();
  renderTruck();
  renderTrailer();
  renderEquipment();
  renderCombos();
}

// Touch support for mobile devices
function initTouchSupport() {
  // Add touch event listeners for drag and drop on mobile
  let touchDragSource = null;
  
  document.addEventListener('touchstart', function(e) {
    if (e.target.classList.contains('tile')) {
      touchDragSource = e.target;
      e.target.classList.add('dragging');
    }
  }, { passive: false });
  
  document.addEventListener('touchend', function(e) {
    if (touchDragSource) {
      touchDragSource.classList.remove('dragging');
      
      // Find the drop target
      const touch = e.changedTouches[0];
      const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
      
      if (dropTarget) {
        const col = dropTarget.closest('.column') || 
                   dropTarget.closest('.resource-list') || 
                   dropTarget.closest('.permanent-box') ||
                   dropTarget.closest('.location-zone');
        
        if (col) {
          // Handle drop based on target type
          if (col.classList.contains('location-zone')) {
            const locationName = col.querySelector('h3').textContent.replace(/[üèôÔ∏èüèÅüåâ ]/g, '').trim();
            
            // Create a synthetic event for dropLocation
            const syntheticEvent = {
              preventDefault: () => {},
              dataTransfer: {
                getData: (type) => type === 'text' ? touchDragSource.id : 'tile'
              },
              target: dropTarget,
              clientX: touch.clientX,
              clientY: touch.clientY
            };
            
            dropLocation(syntheticEvent, locationName);
          } else {
            // Create a synthetic event for drop
            const syntheticEvent = {
              preventDefault: () => {},
              dataTransfer: {
                getData: (type) => {
                  if (type === 'text') return touchDragSource.id;
                  if (type === 'type') return 'tile';
                  return '';
                },
                setData: () => {}
              },
              target: dropTarget,
              clientX: touch.clientX,
              clientY: touch.clientY
            };
            
            drop(syntheticEvent);
          }
        }
      }
      
      touchDragSource = null;
    }
  }, { passive: false });
  
  document.addEventListener('touchmove', function(e) {
    if (touchDragSource) {
      e.preventDefault(); // Prevent scrolling while dragging
      
      const touch = e.touches[0];
      const dropIndicator = document.getElementById('touch-drop-indicator') || 
                           createDropIndicator();
      
      dropIndicator.style.left = (touch.clientX - 20) + 'px';
      dropIndicator.style.top = (touch.clientY - 20) + 'px';
      dropIndicator.style.display = 'block';
    }
  }, { passive: false });
  
  function createDropIndicator() {
    const indicator = document.createElement('div');
    indicator.id = 'touch-drop-indicator';
    indicator.style.position = 'fixed';
    indicator.style.width = '40px';
    indicator.style.height = '40px';
    indicator.style.borderRadius = '50%';
    indicator.style.backgroundColor = 'rgba(209, 163, 255, 0.5)';
    indicator.style.pointerEvents = 'none';
    indicator.style.zIndex = '9999';
    document.body.appendChild(indicator);
    return indicator;
  }
}

document.addEventListener('DOMContentLoaded', function() {
  // Check authentication session on load
  checkAuthSession();
  
  // Make all resource tiles selectable for combos
  document.querySelectorAll('.resource-list .tile').forEach(tile => {
    tile.onclick = toggleSelection;
  });
  
  // Set up login form submission
  document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    attemptLogin();
  });
  
  // Initialize touch support for mobile devices
  initTouchSupport();
});
</script>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <!-- Cloud sync injection -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="/js/cloud.js"></script>


<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = "https://ldbjgdfkjnpxwvrofmkx.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxkYmpnZGZram5weHd2cm9mbWt4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4OTMwMTYsImV4cCI6MjA3MDQ2OTAxNn0.2DeJq25bo_3nKG_PhkWaUUssVjUqQSRqsoeo8zZ4dFg";
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
 
  // Initialize sync status variables
  let syncInProgress = false;
  let autoSyncEnabled = false;
  let autoSyncInterval = null;
 
  // Function to sync all data with Supabase
  async function syncAllData() {
    if (syncInProgress) return;
   
    syncInProgress = true;
    const syncButton = document.getElementById('btnSyncNow');
    const originalText = syncButton.textContent;
    syncButton.textContent = '‚è≥ Syncing...';
   
    try {
      // 1. Sync user data
      await syncUserData();
     
      // 2. Sync schedule data
      await syncScheduleData();
     
      // 3. Sync resources
      await syncResourceData();
     
      // 4. Sync location data
      await syncLocationData();
     
      // Show success message
      syncButton.textContent = '‚úÖ Synced!';
      setTimeout(() => {
        syncButton.textContent = originalText;
      }, 2000);
     
    } catch (error) {
      console.error('Sync failed:', error);
      syncButton.textContent = '‚ùå Failed!';
      setTimeout(() => {
        syncButton.textContent = originalText;
      }, 2000);
     
    } finally {
      syncInProgress = false;
    }
  }
 
async function syncUserData() {
  try {
    // Get existing users from Supabase
    const { data: existingUsers, error: fetchError } = await supabase
      .from('users')
      .select('*');
     
    if (fetchError) throw fetchError;
   
    // Update UI if on user management page
    if (document.getElementById('page3').classList.contains('active') && isAdmin) {
      loadUserList();
    }
  } catch (error) {
    console.error('Error syncing user data:', error);
  }
}

async function syncScheduleData() {
  try {
    // Get existing schedules from Supabase
    const { data: existingScheds, error: fetchError } = await supabase
      .from('schedules')
      .select('*')
      .eq('user', currentUser)
      .order('created_at', { ascending: false })
      .limit(50);
     
    if (fetchError) throw fetchError;
   
    // Update UI
    populateSavedFirst();
    populateSaved();
  } catch (error) {
    console.error('Error syncing schedule data:', error);
  }
}

async function syncResourceType(resourceType) {
  try {
    // Get existing resources from Supabase
    const { data: existingResources, error: fetchError } = await supabase
      .from(resourceType)
      .select('*');
     
    if (fetchError) throw fetchError;
   
    // Update UI based on resource type
    if (resourceType === 'crews') renderCrew();
    else if (resourceType === 'trucks') renderTruck();
    else if (resourceType === 'trailers') renderTrailer();
    else if (resourceType === 'equipment') renderEquipment();
    else if (resourceType === 'combos') renderCombo();
  } catch (error) {
    console.error(`Error syncing ${resourceType}:`, error);
  }
}

async function syncLocationData() {
  try {
    // Get existing location data from Supabase
    const { data: existingLocations, error: fetchError } = await supabase
      .from('locations')
      .select('*')
      .eq('user', currentUser)
      .single();
     
    if (fetchError && fetchError.code !== 'PGRST116') throw fetchError; // Ignore "not found" error
   
    // Update UI if on the locations page
    if (existingLocations && document.getElementById('page4').classList.contains('active')) {
      loadLocations();
    }
  } catch (error) {
    console.error('Error syncing location data:', error);
  }
}
 
  // Toggle auto-sync
  function toggleAutoSync() {
    const autoSyncBtn = document.getElementById('btnAutoSync');
   
    if (autoSyncEnabled) {
      // Disable auto-sync
      clearInterval(autoSyncInterval);
      autoSyncEnabled = false;
      autoSyncBtn.textContent = '‚è± Auto-sync (30s)';
      autoSyncBtn.style.backgroundColor = '';
    } else {
      // Enable auto-sync
      autoSyncEnabled = true;
      autoSyncBtn.textContent = '‚è± Auto-sync (ON)';
      autoSyncBtn.style.backgroundColor = '#c8e6c9'; // Light green background
     
      // Sync immediately
      syncAllData();
     
      // Set up interval for auto-sync every 30 seconds
      autoSyncInterval = setInterval(syncAllData, 30000);
    }
  }
 
  // Add event listeners when document is loaded
  document.addEventListener('DOMContentLoaded', function() {
    // Add event listener for Sync Now button
    const syncNowBtn = document.getElementById('btnSyncNow');
    if (syncNowBtn) {
      syncNowBtn.addEventListener('click', syncAllData);
    }
   
    // Add event listener for Auto Sync button
    const autoSyncBtn = document.getElementById('btnAutoSync');
    if (autoSyncBtn) {
      autoSyncBtn.addEventListener('click', toggleAutoSync);
    }
  });
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>
</html>

<script>
function exportToPDF() {
  const loadingDiv = document.createElement('div');
  loadingDiv.innerHTML = 'Generating PDF...';
  loadingDiv.style.position = 'fixed';
  loadingDiv.style.top = '50%';
  loadingDiv.style.left = '50%';
  loadingDiv.style.transform = 'translate(-50%, -50%)';
  loadingDiv.style.background = 'rgba(0,0,0,0.7)';
  loadingDiv.style.color = 'white';
  loadingDiv.style.padding = '20px';
  loadingDiv.style.borderRadius = '10px';
  loadingDiv.style.zIndex = '9999';
  document.body.appendChild(loadingDiv);

  html2canvas(document.getElementById('board')).then(canvas => {
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jspdf.jsPDF('l', 'mm', 'a4');
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();
    pdf.setFontSize(18);
    pdf.text('R&S Weekly Schedule', pdfWidth/2, 15, {align: 'center'});
    pdf.setFontSize(12);
    pdf.text('Generated: ' + new Date().toLocaleString(), pdfWidth/2, 22, {align: 'center'});
    const imgProps = pdf.getImageProperties(imgData);
    const imgWidth = pdfWidth - 20;
    const imgHeight = imgWidth * imgProps.height / imgProps.width;
    pdf.addImage(imgData, 'PNG', 10, 30, imgWidth, imgHeight);
    pdf.save('schedule_' + new Date().toISOString() + '.pdf');
    document.body.removeChild(loadingDiv);
  });
}
</script>

<script>
async function initializeUsers() {
  const { data, error } = await supabase.from('users').select('*');
  if (error) {
    console.error('Error fetching users:', error);
    return;
  }
  if (!data || data.length === 0) {
    await supabase.from('users').insert([
      { username: 'ADMIN', password: '4630', role: 'admin', passwordChanged: true }
    ]);
  } else {
    const adminExists = data.some(u => u.username.toUpperCase() === 'ADMIN');
    if (!adminExists) {
      await supabase.from('users').insert([
        { username: 'ADMIN', password: '4630', role: 'admin', passwordChanged: true }
      ]);
    }
  }
}
document.addEventListener('DOMContentLoaded', function() {
  initializeUsers();
});
</script>
